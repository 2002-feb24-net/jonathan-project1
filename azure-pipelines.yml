# Azure Pipelines YAML documentation
# https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema

# this file defines a set of jobs that will run when triggered on a cloned version of your repo.
# a job is a set of steps
# by default, ther'es just one job, and you give it its list of steps

# by default, all branches get built
# but adding a trigger configuration like this says "only build master branch"
trigger:
- master

# a pool is a set of machines for running this job.
# this configuration says: "use Microsoft's hosted Ubuntu Linux virtual machines"
# (we could, if we wanted, have it connect to a machine WE control to run the job on)
pool:
  vmImage: 'ubuntu-latest'

# the steps in the job
# "script" is one kind of step - on linux it'll run in bash
# on windows it'll run in command prompt
# give all steps a good display name
steps:

# - script: echo Hello, world!
#   displayName: Print hello world

# - script: |
#     echo "Showing current directory contents"
#     ls
#   displayName: Show directory contents

- script: dotnet build
  # workingDirectory: 'MyProject1Folder'
  displayName: dotnet build

- script: dotnet test --logger trx
  displayName: dotnet test

- task: PublishTestResults@2
  condition: succeededOrFailed()
  inputs: 
    testRunneR: VSTest
    testResultsFiles: '**/*.trx'
  displayName: Publish test results to build

- task: DotNetCoreCLI@2
  inputs: 
    command: 'publish'
    publishWebProjects: true

- task: AzureRmWebAppDeployment@4
  inputs:
    ConnectionType: 'AzureRM'
    azureSubscription: 'Azure subscription 1(0331d11f-08e8-4a46-91f1-7c02b4a66c26)'
    appType: 'webApp'
    WebAppName: 'WheyMen-Jonathan-P1'
    packageForLinux: '$(System.DefaultWorkingDirectory)/**/*.zip'

